<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen 发展历程与深度解析</title>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/framer-motion/10.16.4/framer-motion.umd.min.js"></script>
    <style>
        body {
            background-color: #1a1a2e; /* 深色背景 */
            color: #e0e0e0; /* 亮色文字 */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1; /* 确保在内容之下 */
        }
        .content-card {
            background: rgba(255, 255, 255, 0.05); /* 玻璃拟态背景 */
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(128, 0, 128, 0.3), 0 0 30px rgba(0, 0, 255, 0.2); /* 霓虹光效 */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .content-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 0 25px rgba(128, 0, 128, 0.6), 0 0 45px rgba(0, 0, 255, 0.4); /* 悬停发光效果 */
        }
        h1, h2, h3 {
            color: #9f7aea; /* 紫色标题 */
            font-weight: bold;
        }
        h1 { font-size: 2.5em; margin-bottom: 1em; text-align: center; }
        h2 { font-size: 2em; margin-top: 1.5em; margin-bottom: 0.8em; border-bottom: 2px solid #9f7aea; padding-bottom: 0.3em;}
        h3 { font-size: 1.5em; margin-top: 1em; margin-bottom: 0.5em; color: #63b3ed; }
        p, li {
            line-height: 1.8;
            margin-bottom: 1em;
            color: #c0c0c0;
        }
        ul { list-style-type: disc; margin-left: 20px; }
        strong { color: #a0aec0; }
        .reference-link {
            font-size: 0.8em;
            color: #63b3ed;
            text-decoration: none;
            margin-left: 5px;
        }
        .reference-link:hover {
            text-decoration: underline;
        }
        .icon {
            margin-right: 8px;
            color: #9f7aea;
        }
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            background: rgba(0,0,0,0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .footer a {
            color: #9f7aea;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        /* 滚动动画的初始状态 */
        .scroll-animate {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; /* Added transition for smoothness */
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="container mx-auto px-4 py-8">
        <header class="text-center my-12">
            <h1 class="text-5xl font-bold text-purple-400">Qwen 发展历程与深度解析</h1>
        </header>

        <main id="main-content">
            <!-- Markdown content will be inserted here by JavaScript -->
        </main>

        <footer class="footer">
            <p class="text-gray-400">信息来源：综合网络资源，包括但不限于维基百科、Qwen官网、各类科技媒体文章等。</p>
            <p>
                <a href="https://www.tongyi.com" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-globe icon"></i>Qwen 官方网站
                </a>
            </p>
            <p class="mt-2 text-sm text-gray-500">&copy; 2024 AI Timeline Project. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Initialize Particles.js
        particlesJS('particles-js', {
            "particles": {
                "number": {
                    "value": 80,
                    "density": {
                        "enable": true,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#ffffff"
                },
                "shape": {
                    "type": "circle",
                    "stroke": {
                        "width": 0,
                        "color": "#000000"
                    },
                    "polygon": {
                        "nb_sides": 5
                    }
                },
                "opacity": {
                    "value": 0.5,
                    "random": false,
                    "anim": {
                        "enable": false,
                        "speed": 1,
                        "opacity_min": 0.1,
                        "sync": false
                    }
                },
                "size": {
                    "value": 3,
                    "random": true,
                    "anim": {
                        "enable": false,
                        "speed": 40,
                        "size_min": 0.1,
                        "sync": false
                    }
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ffffff",
                    "opacity": 0.4,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 6,
                    "direction": "none",
                    "random": false,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false,
                    "attract": {
                        "enable": false,
                        "rotateX": 600,
                        "rotateY": 1200
                    }
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "repulse"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    },
                    "resize": true
                },
                "modes": {
                    "grab": {
                        "distance": 400,
                        "line_linked": {
                            "opacity": 1
                        }
                    },
                    "bubble": {
                        "distance": 400,
                        "size": 40,
                        "duration": 2,
                        "opacity": 8,
                        "speed": 3
                    },
                    "repulse": {
                        "distance": 200,
                        "duration": 0.4
                    },
                    "push": {
                        "particles_nb": 4
                    },
                    "remove": {
                        "particles_nb": 2
                    }
                }
            },
            "retina_detect": true
        });

        const markdownContent = `
# 通义千问信息

## 一.起始点和研究动机

通义千问是阿里云自主研发的超大规模语言模型。其研究动机在于打造一个能理解和生成人类语言，并具备多模态能力的通用人工智能模型，旨在应对日益复杂的AI应用需求，推动人工智能技术的普惠化，赋能千行百业的智能化转型。阿里云致力于通过通义千问构建开放、繁荣的AI生态。

通义千问由阿里云CTO周靖人领导的阿里云智能团队负责研发和持续迭代。该团队汇集了在自然语言处理、计算机视觉、机器学习等领域的顶尖专家。

## 二.版本发布、技术改进和优势

通义千问模型体系庞大，涵盖了多种参数规模和针对特定优化的模型版本，以下按照时间线和模型系列进行梳理：

### 2.1早期发布与奠基
*   **2023年4月7日:** 阿里云正式发布“通义千问”大语言模型，并启动企业邀请测试。这标志着阿里云全面进军大模型领域。 <mcreference link="https://baike.baidu.com/item/%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE/62211001" index="1">1</mcreference>
*   **2023年9月28日:** 阿里云人工智能平台PAI的EAS（Elastic Algorithm Service）服务支持一键部署基于开源模型**通义千问-7B (Qwen-7B)** 的WebUI应用。Qwen-7B是基于Transformer架构的大语言模型，在包含大量网络文本、专业书籍、代码等的超大规模、多样化数据上进行预训练。同时发布了基于此模型的AI助手**Qwen-7B-Chat**。这一举措降低了用户使用和部署大模型的门槛。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>

### 2.2模型能力与平台支持持续增强
*   **2024年2月28日:** PAI-Designer支持LLM数据预处理算子及常用模板，提供去重、标准化、敏感信息打码等高性能分布式数据处理能力，提升LLM模型训练的可靠性和效果。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>
*   **2024年5月:** PAI-QuickStart中的LLM功能支持QLoRA、LoRA及全参数微调，大幅降低了用户进行模型定制化训练的成本。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>
*   **2024年6月:** PAI-QuickStart支持模型评测功能，允许用户基于权威公开数据集或自定义数据集对模型进行综合能力评估。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>
*   **2024年8月26日:** PAI-EAS推出LLM智能路由功能，优化LLM推理服务效率。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>
*   **2024年9月29日:** PAI-DSW（Data Science Workshop）内置通义灵码，提供智能编码辅助能力。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>
*   **2024年11月11日:** PAI推出裁判员模型服务，该服务使用基于Qwen2微调的大模型作为裁判员，对被评估模型的生成结果进行打分，为模型评估提供了新的自动化工具。 <mcreference link="https://www.alibabacloud.com/help/zh/pai/product-overview/llm-supports-qlora-lora-all-parameter-fine-tuning-in-quick-start" index="10">10</mcreference>

### 2.3通义千问商业版模型系列 (部分列举，以官方最新文档为准)

阿里云百炼平台提供了丰富的通义千问商业版模型，涵盖文本生成、视觉、语音、代码、数学等多个领域。

*   **通义千问 (基础文本模型):**
    *   'qwen-turbo': 高性价比主力模型，支持思考模式和非思考模式，在推理、人类偏好、Agent、多语言及回复格式方面有显著提升。上下文长度8k-32k Token，最大输出2k-8k Token。
    *   'qwen-plus': 平衡性能与成本的模型，上下文长度32k Token，最大输出2k Token。
    *   'qwen-max': 最高性能模型，上下文长度8k-200k Token，最大输出2k-8k Token。
    *   'qwen-long': 专为长文本处理设计，支持高达1000万Token上下文，适用于长文档问答、摘要等场景。
*   **通义千问VL (视觉语言模型):**
    *   'qwen-vl-plus': 视觉理解旗舰模型，支持图像、视频输入，上下文长度32k-128k Token，增强了图像和视频的理解能力，包括多语种和手写体识别，以及数学、推理、监控视频内容理解。
    *   'qwen-vl-chat': 视觉对话模型，支持图像输入和文本输出。
    *   'qwen-vl-ocr': 专用于文字提取的OCR模型，专注于文档、表格、试题、手写体等图像的文字识别，支持多种语言。
*   **通义千问Audio (音频语言模型):**
    *   'qwen-audio-turbo': 音频理解模型，支持多种音频输入（人声、自然音、音乐、歌声）和文本，具备转录、语义理解、情感分析、音频事件检测、语音聊天能力。上下文长度8k Token。
    *   'qwen-audio-asr' (Beta): 专用于语音识别的模型，支持中英文，准确率高于'qwen-audio-turbo'，支持更长音频（3分钟）。
*   **通义千问数学模型:**
    *   'qwen-math-plus' / 'qwen-math-turbo': 专门用于数学解题的语言模型，上下文长度4k Token。
*   **通义千问Coder (代码模型):**
    *   'qwen-coder-plus' / 'qwen-coder-turbo': 代码生成与理解模型，上下文长度高达128k Token。
*   **通义千问翻译模型:**
    *   'qwen-mt-plus' / 'qwen-mt-turbo': 机器翻译大语言模型，擅长中英互译及26种小语种互译，提供术语干预、领域提示等能力。上下文长度2k Token。
*   **通义千问Omni (多模态模型):**
    *   'qwen-omni': 多模态理解生成大模型，支持文本、图像、语音、视频输入，并能同时流式生成文本和语音。
*   **QwQ (推理增强模型):**
    *   'qwq': 视觉推理模型，支持视觉输入及思维链输出，在数学、编程、视觉分析等任务上表现更强。

### 2.4通义千问开源模型系列

阿里云积极拥抱开源，陆续开源了多个版本的通义千问模型，参数规模从5亿到数千亿不等，推动了AI社区的发展。

*   **Qwen1.5系列 (2024年初陆续发布):**
    *   包括0.5B, 1.8B, 7B, 14B, 32B, 72B, 110B等多种参数规模的Chat模型。上下文长度普遍为32k Token。
    *   技术特点：在预训练数据、指令遵循、长文本生成、结构化数据理解等方面有显著改进，支持超过29种语言。
*   **Qwen2系列 (2024年中陆续发布):**
    *   包括0.5B, 1.5B, 7B, 57B-A14B, 72B等参数规模的Instruct模型。上下文长度普遍为32k-128k Token。
    *   技术特点：在Qwen1.5基础上进一步提升，特别是在代码和数学能力上增强。
*   **Qwen2.5系列 (2024年末陆续发布):**
    *   包括0.5B, 1.5B, 3B, 7B, 14B, 32B, 72B等Instruct模型，以及支持1M上下文的'qwen2.5-14b-instruct-1m'和'qwen2.5-7b-instruct-1m'。
    *   技术特点：在更大规模数据集（18万亿Token）上预训练，知识更丰富，编码和数学能力大幅提高，指令遵循、长文本生成、结构化数据理解和JSON输出能力显著改进。
    *   **Qwen2.5-Coder (2024年11月12日开源):** 32B尺寸旗舰代码模型在多项基准评测中取得开源最佳成绩，部分超越闭源模型GPT-4o。 <mcreference link="https://developer.aliyun.com/article/1490030" index="8">8</mcreference> <mcreference link="https://developer.aliyun.com/article/1490030" index="9">9</mcreference>
*   **Qwen3系列 (2025年初陆续发布):**
    *   包括0.6B, 1.7B, 4B, 8B, 14B, 30B-A3B, 32B, 235B-A22B等多种参数规模的模型。
    *   技术特点：支持思考模式和非思考模式。推理能力（数学、代码、逻辑）、人类偏好能力（创意写作、角色扮演、多轮对话）、Agent能力、多语言能力（支持100+语言和方言）均大幅提升，并修复了回复格式问题。
*   **QwQ-开源版:**
    *   'qwq-32b': 基于Qwen2.5-32B训练的推理模型，数学代码等核心指标达到业界顶尖水平。
    *   'qwq-32b-preview': 实验性研究模型，专注增强AI推理能力，尤其在数学和编程领域。
*   **QVQ-开源版:**
    *   'qvq-72b-preview': 实验性视觉推理模型，专注提升数学推理能力。
*   **Qwen-VL (开源视觉语言模型):**
    *   'qwen-vl-v1', 'qwen2-vl-2b/7b/72b-instruct', 'qwen2.5-vl-3b/7b/32b/72b-instruct'。
    *   Qwen2.5-VL在物体识别、文本图表分析、长视频理解、视觉定位、结构化输出方面有显著提升。
*   **Qwen-Audio (开源音频语言模型):**
    *   'qwen-audio-chat', 'qwen2-audio-instruct'。提升了音频理解和语音聊天能力。
*   **Qwen-Math (开源数学模型):**
    *   'qwen2.5-math-1.5b/7b/72b-instruct'。支持中英文，整合CoT, PoT, TIR等推理方法。
*   **Qwen-Coder (开源代码模型):**
    *   'qwen2.5-coder-0.5b/1.5b/3b/7b/14b/32b-instruct'。在5.5万亿Token编程数据上训练，竞争力强。

### 2.5通义千问App与生态集成
*   **2024年12月17日:** 通义千问App正式上线，提供全方位智能助手服务。 <mcreference link="https://baike.baidu.com/item/%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE/62211001" index="1">1</mcreference>
*   **2024年12月18日:** 通义千问升级，具备长文本、多模态和Agent能力。 <mcreference link="https://baike.baidu.com/item/%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE/62211001" index="1">1</mcreference>
*   **2024年12月20日 - 2025年4月25日:** 通义千问App陆续接入钉钉、支付宝、淘宝、高德地图、盒马、飞书、闲鱼、饿了么、优酷、夸克等阿里生态应用，提供AI问答、文案创作、会议纪要、智能助手等多样化服务。 <mcreference link="https://baike.baidu.com/item/%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE/62211001" index="1">1</mcreference>

## 三.重要里程碑和成就

*   **2023年4月7日:** 通义千问正式发布，标志着阿里云全面发力大模型技术。
*   **2023年起持续开源:** 陆续开源Qwen系列模型（Qwen-7B, Qwen1.5, Qwen2, Qwen2.5, Qwen3等），参数规模从亿级到千亿级，覆盖文本、视觉、代码等多个模态，极大地推动了AI开源社区的发展和技术普惠。
*   **多个模型在权威评测中取得领先:** 例如，Qwen2.5-Coder 32B模型在代码生成任务上超越GPT-4o；QwQ模型在数学和代码推理评测中表现优异。
*   **长文本处理能力突破:** Qwen-Long模型支持千万级Token上下文，为处理海量文本信息提供了可能。
*   **多模态能力持续进化:** 从最初的文本模型，发展到支持图像、语音、视频输入的Qwen-VL、Qwen-Audio、Qwen-Omni等模型，展现了强大的多模态理解与生成能力。
*   **通义千问App上线及生态融合:** 将大模型能力便捷地提供给广大用户，并深度融入阿里生态的各项服务中，加速AI技术在各行各业的落地。
*   **模型即服务（MaaS）理念的践行:** 通过阿里云百炼平台，提供丰富的模型选择和便捷的API调用，降低企业使用AI的门槛。

## 四.实际应用案例

*   **企业服务与办公:**
    *   **钉钉:** 集成通义千问，提供智能问答、会议纪要、日程安排、文档创作等功能，提升办公效率。
    *   **阿里云客服:** 利用通义千问提升智能客服的理解和应答能力。
    *   **企业知识库构建与问答:** 帮助企业构建智能知识库，实现高效信息检索和智能问答。
*   **编程与开发:**
    *   **通义灵码 (集成于DSW等开发工具):** 提供代码补全、代码解释、单元测试生成、Bug修复等功能，辅助开发者提升编程效率和代码质量。
    *   **PAI平台:** 支持开发者基于通义千问进行模型微调、部署和应用开发，例如快速生成个人简历应用、小游戏等。 <mcreference link="https://developer.aliyun.com/article/1490030" index="8">8</mcreference>
*   **电商与零售:**
    *   **淘宝/天猫:** 应用于智能导购、商品描述生成、营销文案创作、智能客服等场景。
    *   **盒马:** 提供智能生鲜购物助手服务。
*   **生活服务:**
    *   **支付宝:** 提供智能生活助手服务，如账单分析、理财建议等。
    *   **高德地图:** 提供智能出行规划、地点信息问答等服务。
    *   **饿了么:** 提供智能外卖点餐助手服务。
    *   **闲鱼:** 提供智能二手交易助手服务。
*   **内容创作与媒体:**
    *   **优酷:** 提供智能视频内容分析、摘要生成、字幕翻译等服务。
    *   **夸克:** 结合搜索场景，提供更智能的搜索答案和内容生成。
    *   **营销文案、新闻稿件、小说、诗歌等文本创作。**
*   **教育领域:**
    *   **智能辅导:** 为学生提供个性化学习辅导和答疑。
    *   **教学资源生成:** 辅助教师生成教案、课件、试题等。
*   **医疗健康:** (潜力领域，需严格遵守合规要求)
    *   **辅助诊断:** 基于医学文献和病例数据，辅助医生进行疾病诊断。
    *   **药物研发:** 加速新药发现和临床试验数据分析。
    *   **健康咨询:** 提供初步的健康咨询和建议。
*   **金融领域:**
    *   **智能投顾、风险控制、金融报告生成、反欺诈等。**

## 五.社会讨论和影响

通义千问的快速发展和广泛应用，引发了社会各界对人工智能技术的热烈讨论：
*   **生产力提升与产业变革:** AI大模型被视为继蒸汽机、电力、互联网之后又一颠覆性的技术，有望大幅提升各行各业的生产效率，催生新的商业模式和产业形态。
*   **就业结构调整:** AI在替代部分重复性劳动的同时，也创造了新的就业岗位，对劳动力市场结构产生深远影响。
*   **数据隐私与安全:** 大模型的训练和运行依赖海量数据，如何保障用户数据隐私和模型自身安全成为关注焦点。阿里云强调其在数据安全和合规方面的投入。
*   **算法偏见与公平性:** 模型可能学习并放大训练数据中存在的偏见，导致不公平的结果。持续优化算法、采用多样化数据是应对挑战的关键。
*   **信息真实性与滥用风险:** AI生成内容的逼真度越来越高，也带来了虚假信息传播、恶意利用（如深度伪造）的风险。
*   **伦理规范与法律法规:** 面对AI技术的快速发展，社会各界呼吁建立健全相关的伦理规范和法律法规，以引导技术向善发展。中国及全球多国政府已开始着手制定相关政策。

## 六.局限性与未来发展方向

尽管通义千问取得了显著成就，但仍面临一些局限性并有广阔的发展空间：

**当前局限性:**
*   **复杂推理与规划能力:** 对于需要多步复杂推理、深度逻辑思考或长期规划的任务，现有模型能力仍有提升空间。
*   **事实幻觉 (Hallucination):** 大模型有时会生成看似合理但不符合事实的错误信息。
*   **可解释性不足:** 深度学习模型的“黑箱”特性使得其决策过程难以完全解释，影响了在一些高风险领域的应用。
*   **知识更新滞后性:** 模型的知识主要来源于训练数据，对于训练截止日期之后的新知识可能无法及时掌握（尽管部分模型通过联网等方式有所缓解）。
*   **计算资源消耗:** 大模型的训练和推理需要巨大的计算资源，成本较高，普惠应用仍面临挑战。
*   **对细微语境和情感的理解:** 虽然有进步，但在理解人类语言中微妙的语境、情感和潜台词方面仍有提升空间。

**未来发展方向:**
*   **更强的通用人工智能 (AGI) 能力:** 持续提升模型的理解、推理、学习和创造能力，向更通用的AGI迈进。
*   **多模态深度融合:** 实现文本、图像、语音、视频等多种模态信息之间更自然、更深层次的理解、转换和生成。
*   **可控性与可靠性增强:** 提高模型输出的可控性，减少幻觉，增强事实准确性和逻辑一致性。
*   **高效训练与推理:** 研发更高效的模型架构、训练算法和推理引擎，降低AI应用的成本和门槛。
*   **Agent智能体进化:** 发展更强大的AI Agent，使其能自主理解复杂任务、规划执行步骤、并与外部工具和环境交互以达成目标。
*   **个性化与自适应学习:** 使模型能够根据用户偏好和特定场景进行个性化适配和持续学习。
*   **伦理与安全内建:** 将伦理考量和安全机制更深度地融入模型设计和开发全流程。
*   **开放生态与协同创新:** 持续推动开源，与全球开发者和研究者共同构建繁荣的AI生态系统。
*   **端侧与边缘计算部署:** 推动大模型在端侧设备和边缘计算节点的轻量化部署，实现更低延迟、更保护隐私的应用。

`;

        // Convert Markdown to HTML and inject it into the main content area
        // Wrap sections in cards for styling and animation
        function renderMarkdown() {
            const mainContentElement = document.getElementById('main-content');
            if (!mainContentElement) {
                console.error("renderMarkdown Error: 'main-content' element not found!");
                document.body.innerHTML = "Error: 'main-content' element not found! Critical error."; // Drastic fallback
                return;
            }

            console.log("renderMarkdown: Starting. Markdown content length:", markdownContent ? markdownContent.length : 0);

            if (!markdownContent || markdownContent.trim() === "") {
                mainContentElement.innerHTML = "<div class='content-card' style='opacity:1; transform:translateY(0);'><p>Error: Markdown content is empty or missing.</p></div>";
                console.warn("renderMarkdown: markdownContent is empty.");
                return;
            }

            try {
                const rawHtml = marked.parse(markdownContent.replace(/<mcreference[^>]*>[^<]*<\/mcreference>/g, ''));
                console.log("renderMarkdown: Parsed HTML length:", rawHtml ? rawHtml.length : 0);

                if (!rawHtml || rawHtml.trim() === "") {
                    mainContentElement.innerHTML = "<div class='content-card' style='opacity:1; transform:translateY(0);'><p>Error: Parsing markdown resulted in empty HTML. Check console for details (e.g., issues with 'marked' library or markdown syntax).</p></div>";
                    console.warn("renderMarkdown: marked.parse(markdownContent) resulted in empty HTML.");
                    return;
                }

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = rawHtml;

                if (tempDiv.children.length === 0 && rawHtml.trim() !== "") {
                    console.warn("renderMarkdown: No child elements found after parsing markdown, but raw HTML is not empty. Displaying raw HTML.");
                    mainContentElement.innerHTML = rawHtml;
                    addScrollAnimations();
                    return;
                }

                let cardHtml = '';
                let currentCardContent = '';
                let cardCount = 0;

                Array.from(tempDiv.children).forEach(node => {
                    if (node.tagName === 'H1') { // Skip the main H1, it's already in the header
                        return;
                    }

                    if (node.tagName === 'H2') {
                        if (currentCardContent) { // If there's content for a previous card, finalize it
                            cardHtml += `<div class="content-card scroll-animate">${currentCardContent}</div>`;
                            cardCount++;
                        }
                        currentCardContent = node.outerHTML; // Start new card with H2
                    } else {
                        // Append other content to the current card section
                        if (currentCardContent) { // If a card (started by H2) is active
                            currentCardContent += node.outerHTML;
                        } else if (cardHtml === '' && !currentCardContent) {
                            // This handles content that might appear before the very first H2 (after skipping H1)
                            // It starts the first card with this content.
                            currentCardContent = node.outerHTML;
                        }
                        // Content not fitting these conditions (e.g. orphaned after a card is closed but before new H2) might be skipped.
                        // Given the expected structure (H1, then H2 sections), this should be robust.
                    }
                });

                if (currentCardContent) { // Finalize the last card's content
                    cardHtml += `<div class="content-card scroll-animate">${currentCardContent}</div>`;
                    cardCount++;
                }

                console.log("renderMarkdown: Number of cards generated:", cardCount);
                console.log("renderMarkdown: Final cardHtml length:", cardHtml.length);

                if (cardHtml.trim() !== "") {
                    mainContentElement.innerHTML = cardHtml;
                } else if (rawHtml.trim() !== "") {
                    console.warn("renderMarkdown: Card generation resulted in empty HTML. Falling back to raw HTML.");
                    mainContentElement.innerHTML = rawHtml; // Fallback to raw HTML if card logic produced nothing but parsing was successful
                } else {
                    mainContentElement.innerHTML = "<div class='content-card' style='opacity:1; transform:translateY(0);'><p>Error: Failed to generate card HTML and raw HTML is also empty. Content processing failed.</p></div>";
                    console.error("renderMarkdown: Both cardHtml and rawHtml are effectively empty after processing.");
                }

                addScrollAnimations(); // Apply scroll animations to newly added cards

            } catch (error) {
                mainContentElement.innerHTML = `<div class='content-card' style='opacity:1; transform:translateY(0);'><p>Error during markdown rendering: ${error.message}. Check browser console for stack trace.</p></div>`;
                console.error("Error in renderMarkdown function execution:", error);
            }
        }

        // Scroll-triggered animations using a single IntersectionObserver
        function addScrollAnimations() {
            const animatedElements = document.querySelectorAll('.scroll-animate');
            if (animatedElements.length === 0) {
                // console.warn("addScrollAnimations: No '.scroll-animate' elements found to animate.");
                return;
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0px)';
                        observer.unobserve(entry.target); // Animate only once
                    }
                });
            }, { threshold: 0.1 }); // Trigger when 10% of the element is visible

            animatedElements.forEach(el => {
                observer.observe(el);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                renderMarkdown(); // This function now also calls addScrollAnimations internally
            } catch (e) {
                console.error("Error during initial page setup (DOMContentLoaded):", e);
                const mainContentElement = document.getElementById('main-content');
                if (mainContentElement) {
                    // Display a user-friendly error message on the page
                    mainContentElement.innerHTML = `
                        <div class="content-card" style="color: #ff6b6b; background: rgba(255,255,255,0.1); opacity:1; transform:translateY(0);">
                            <h2 style="color: #ff6b6b;"><i class="fas fa-exclamation-triangle icon"></i> 页面加载错误</h2>
                            <p>抱歉，加载此页面内容时发生错误。</p>
                            <p><strong>错误详情:</strong> ${e.message}</p>
                            <p>请尝试刷新页面，或按 F12 打开浏览器控制台查看更多技术信息。</p>
                        </div>`;
                } else {
                    // Fallback if main-content is not even available
                    document.body.innerHTML = `错误: ${e.message}. 未找到主要内容容器。`;
                }
            }
        });

    </script>
</body>
<html>
